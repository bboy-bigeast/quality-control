{% extends "base.html" %}
{% block title %}干膜标准列表{% endblock %}
{% block content %}
<div class="container mt-4">
    <div class="d-grid mb-4" style="grid-template-columns: auto 1fr;"> 
        <!-- 标题在左，按钮组在右 -->
        <h2 class="text-primary">干膜标准列表</h2>
        
        <div class="d-flex justify-content-end"> <!-- 右对齐按钮组 -->
            <a href="{% url 'create_dryfilm_standard' %}" class="btn btn-success me-2">
                <i class="bi bi-plus-circle me-1"></i> 更新产品标准
            </a>
        </div>

    </div>
    
    {% if dryfilmstandards %}
        <div class="alert alert-info">
            共找到 {{ dryfilmstandards|length }} 条记录
        </div>
        
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>产品牌号</th>
                                <th>更新日期</th>
                                <th>编制人</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for dryfilmstandard in dryfilmstandards %}
                            <tr>
                                <td>{{ dryfilmstandard.product_name }}</td>
                                <td>{{ dryfilmstandard.updated_at|date:"Y-m-d" }}</td>
                                <td>{{ dryfilmstandard.producer }}</td>
                                <td>
                                    <a href="{% url 'dryfilm_standard_edit' dryfilmstandard.product_name %}" class="btn btn-sm btn-primary">
                                        <i class="bi bi-pencil"></i> 编辑/查看
                                    </a>
                                    <button class="btn btn-sm btn-danger" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#deleteModal"
                                            data-record-id="{{ dryfilmstandard.id }}"
                                            data-record-name="{{ dryfilmstandard.product_name }}-产品标准">
                                        <i class="bi bi-trash"></i> 删除
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% else %}
    <div class="card">
        <div class="card-body text-center py-5">
            <h4 class="text-muted">暂无干膜标准数据</h4>
            <p class="text-muted">请点击右上角"更新产品标准"按钮创建第一条记录</p>
        </div>
    </div>
    {% endif %}
</div>




<!-- 删除确认模态框 -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle"></i> 确认删除记录
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <p class="mb-0">删除操作不可恢复！请确认是否删除以下记录？</p>
                </div>
                <div class="mt-3">
                    <p id="recordToDeleteInfo" class="lead text-center"></p>
                    <p class="text-center text-muted small">此操作将永久删除该记录的所有数据</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg"></i> 取消
                </button>
                <form id="deleteForm" method="POST" action="{% url 'dryfilm_standard_delete' %}">
                    {% csrf_token %}
                    <input type="hidden" id="recordId" name="record_id" value="">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash"></i> 确认删除
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript 处理删除交互 -->
<script>
// 当模态框显示时，更新记录信息
document.getElementById('deleteModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const recordId = button.getAttribute('data-record-id');
    const recordName = button.getAttribute('data-record-name');
    
    // 设置将要删除的记录信息
    document.getElementById('recordToDeleteInfo').textContent = recordName;
    document.getElementById('recordId').value = recordId;
});

// 成功删除后的回调函数（在实际应用中，由删除视图在成功删除后重定向或返回信息）
function onDeleteSuccess(response) {
    if(response.success) {
        // 删除DOM元素
        const row = document.getElementById('row-'+response.record_id);
        if(row) {
            row.remove();
        }
        
        // 更新记录计数
        const recordCount = document.getElementById('record-count');
        const currentCount = parseInt(recordCount.textContent.match(/\d+/)[0]);
        recordCount.textContent = `共找到${currentCount - 1}条记录`;
        
        // 显示成功通知
        alert(`记录 ${response.record_id} 已成功删除`);
    } else {
        alert('删除失败: ' + response.message);
    }
}
</script>



{% endblock %}